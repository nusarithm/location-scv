# ğŸ“Œ Location Service â€“ Context & Guidelines

## ğŸ— Arsitektur Project

```
/location-svc
  /cmd
    main.go              â†’ entrypoint aplikasi
  /internal
    /db                  â†’ koneksi database Postgres + PostGIS
    /models              â†’ struct data (Simple, Location, GeoJSON, dll)
    /repositories        â†’ query ke DB
    /handlers            â†’ Echo handler (search, geojson)
    /routes              â†’ routing endpoint
  /docs                  â†’ auto generated Swagger docs
  context.md             â†’ file ini
  go.mod
  go.sum
```

## âš™ï¸ Teknologi

* **Golang** (Echo framework)
* **PostgreSQL + PostGIS** (DB: `bgn`)
* **Swagger (swaago/echo-swagger)** untuk dokumentasi API
* **Mapbox** (konsumsi GeoJSON)

---

## ğŸ” Endpoint Search (Tag: `search`)

1. `GET /search/propinsi`
   â†’ list semua propinsi

2. `GET /search/kabupaten?propinsi_id={id}`
   â†’ list kabupaten dalam propinsi

3. `GET /search/kecamatan?kabupaten_id={id}`
   â†’ list kecamatan dalam kabupaten

4. `GET /search/kelurahan?kecamatan_id={id}`
   â†’ list kelurahan dalam kecamatan

ğŸ“Œ Response format:

```json
[
  { "id": 3201, "name": "Kabupaten Bogor" },
  { "id": 3202, "name": "Kabupaten Sukabumi" }
]
```

---

## ğŸŒ Endpoint GeoJSON (Tag: `geojson`)

1. `GET /geojson/propinsi/:id`
2. `GET /geojson/kabupaten/:id`
3. `GET /geojson/kecamatan/:id`
4. `GET /geojson/kelurahan/:id`

ğŸ“Œ Response format:

```json
{
  "type": "Feature",
  "properties": {
    "id": 3201,
    "name": "Kabupaten Bogor",
    "type": "kabupaten"
  },
  "geometry": {
    "type": "Polygon",
    "coordinates": [...]
  }
}
```

---

## ğŸ“– Swagger

* Endpoint Swagger: `http://localhost:8080/swagger/index.html`
* Regenerate docs setelah update anotasi:

```bash
swag init -g cmd/main.go
```

---

## ğŸ”‘ Aturan Coding

* Semua query ke DB lewat **repositories**.
* Handler hanya untuk `bind request` & `return response`.
* Gunakan `ST_AsGeoJSON` untuk geometry â†’ frontend Mapbox.
* Pastikan ada `@Tags` pada anotasi Swagger untuk grouping (`search`, `geojson`).
* Gunakan `snake_case` untuk nama kolom DB, `camelCase` untuk JSON response.

---

## ğŸš€ Alur Development

1. Run Postgres + PostGIS (misal via Docker).
2. Jalankan service:

   ```bash
   go run cmd/main.go
   ```
3. Akses Swagger di browser.
4. Test endpoint pakai Swagger atau `curl`.
5. Commit dengan message jelas (ex: `feat: add geojson kabupaten endpoint`).

## ğŸ³ Docker Setup
- Build & run: `docker-compose up --build`
- App service: http://localhost:8080
- Swagger: http://localhost:8080/swagger/index.html
- DB: PostgreSQL + PostGIS (port 5432, user: postgres, pass: postgres, db: bgn)
- Data persistent di folder: `./data/postgres`
